project (wpilibj)

find_package( OpenCV REQUIRED )

# Java bindings
if (NOT WITHOUT_JAVA)
    find_package(Java REQUIRED)
    include(UseJava)
    set(CMAKE_JAVA_COMPILE_FLAGS "-Xlint:unchecked")

    set(OPENCV_JAVA_INSTALL_DIR ${OpenCV_INSTALL_PATH}/share/OpenCV/java/)

    find_file(OPENCV_JAR_FILE NAMES opencv-${OpenCV_VERSION_MAJOR}${OpenCV_VERSION_MINOR}${OpenCV_VERSION_PATCH}.jar PATHS ${OPENCV_JAVA_INSTALL_DIR} ${OpenCV_INSTALL_PATH}/bin NO_DEFAULT_PATH)

    configure_file(src/generate/WPILibVersion.java.in WPILibVersion.java)

    file(GLOB_RECURSE JAVA_SOURCES src/main/java/*.java)

    add_jar(wpilibj_jar ${JAVA_SOURCES} ${CMAKE_CURRENT_BINARY_DIR}/WPILibVersion.java INCLUDE_JARS hal_jar ntcore_jar ${OPENCV_JAR_FILE} cscore_jar cameraserver_jar wpiutil_jar OUTPUT_NAME wpilibj)

    get_property(WPILIBJ_JAR_FILE TARGET wpilibj_jar PROPERTY JAR_FILE)
    install(FILES ${WPILIBJ_JAR_FILE} DESTINATION "${java_lib_dest}")

    set_property(TARGET wpilibj_jar PROPERTY FOLDER "java")

    if (MSVC)
        set (wpilibj_config_dir ${wpilib_dest})
    else()
        set (wpilibj_config_dir share/wpilibj)
    endif()

    install(FILES wpilibj-config.cmake DESTINATION ${wpilibj_config_dir})
endif()
